<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Konter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body{
      font-family: Arial, sans-serif;
      background:#f2f2f2;
      margin:0;
    }
    header{
      background:#0d6efd;
      color:#fff;
      text-align:center;
      padding:15px;
    }
    .tabs{
      display:flex;
      margin:10px;
      gap:6px;
    }
    .tabs button{
      flex:1;
      padding:10px;
      border:none;
      border-radius:6px;
      background:#fff;
      font-weight:bold;
      color:#0d6efd;
    }
    .tabs button.active{
      background:#0d6efd;
      color:#fff;
    }
    .box{
      background:#fff;
      margin:10px;
      padding:15px;
      border-radius:8px;
      box-shadow:0 2px 4px rgba(0,0,0,.15);
      display:none;
    }
    .box.active{
      display:block;
    }
    .total{
      font-size:22px;
      font-weight:bold;
      margin-top:10px;
    }
  </style>
</head>

<body>

<header>
  <h2>üìä Dashboard Konter</h2>
  <small>Data Harian, Bulanan & Tahunan</small>
</header>

<div class="tabs">
  <button id="btnHarian" class="active" onclick="show('harian')">Harian</button>
  <button id="btnBulanan" onclick="show('bulanan')">Bulanan</button>
  <button id="btnTahunan" onclick="show('tahunan')">Tahunan</button>
</div>

<div id="harian" class="box active">
  <h3>üìÖ Data Hari Ini</h3>
  <div class="total">Rp <span id="harianTotal">0</span></div>
</div>

<div id="bulanan" class="box">
  <h3>üóìÔ∏è Rekap Bulanan</h3>
  <div id="listBulanan"></div>
</div>

<div id="tahunan" class="box">
  <h3>üìÜ Data Tahun Ini</h3>
  <div class="total">Rp <span id="tahunanTotal">0</span></div>
</div>

<script>
function show(id){
  document.querySelectorAll('.box').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.getElementById('btn'+id.charAt(0).toUpperCase()+id.slice(1)).classList.add('active');
}

const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTAP_R50frV13whqx54ctjplc-8xhcN53rHEVk5mkhLeZE283xWnr6TdTBFr-KFymEiaYE_NWgGthpo/pub?gid=716772016&single=true&output=csv";

fetch(CSV_URL)
  .then(r => r.text())
  .then(csv => {
    const rows = csv.split("\n").slice(1);

    const now = new Date();
    const today = now.toLocaleDateString("id-ID");
    const month = now.toLocaleString("id-ID",{month:"long"});
    const year = now.getFullYear().toString();

    let harian=0, bulanan=0, tahunan=0;

    rows.forEach(r=>{
      const c = r.split(",");

      const tgl = c[0];
      const bln = c[2];
      const thn = c[3];
      const total = parseInt(c[11]) || 0;

      if(tgl === today) harian += total;
      if(bln === month && thn === year) bulanan += total;
      if(thn === year) tahunan += total;
    });

    document.getElementById("harianTotal").innerText = harian.toLocaleString("id-ID");
    document.getElementById("bulananTotal").innerText = bulanan.toLocaleString("id-ID");
    document.getElementById("tahunanTotal").innerText = tahunan.toLocaleString("id-ID");
  })
  .catch(err=>{
    alert("Gagal ambil data CSV");
    console.error(err);
  });
</script>
<script>
const bulanMap = {};

fetch(CSV_URL)
  .then(r => r.text())
  .then(csv => {
    const rows = csv.split("\n").slice(1);

    rows.forEach(r => {
      const c = r.split(",");

      const bulan = c[2];              // BULAN
      const total = parseInt(c[11])||0; // TOTAL HARGA

      if(!bulanMap[bulan]) bulanMap[bulan] = 0;
      bulanMap[bulan] += total;
    });

    let html = "";
    for (const b in bulanMap) {
      html += `<p>${b} : <strong>Rp ${bulanMap[b].toLocaleString("id-ID")}</strong></p>`;
    }

    document.getElementById("listBulanan").innerHTML = html;
  });
</script>
</body>
</html>